# 🎯 DumpWatcher - AI不法投棄検知システム

YOLOv8を使用したリアルタイム不法投棄検知システムです。動画から人物の投棄行為を自動検知し、証拠画像と解析結果を生成します。

## ✨ 機能

- 🎬 **動画解析**: MP4、MOV、AVI、MKV形式に対応
- 🤖 **AI物体検知**: YOLOv8による高精度な人物・物体検知
- ⏰ **時刻表示**: 投棄発生時刻を秒単位で表示
- 📸 **証拠画像**: 投棄シーンの自動キャプチャ
- 🎯 **精密判定**: 距離変化・落下検知による投棄行為の特定
- 🌐 **ウェブUI**: 直感的な操作インターフェース

## 🐳 Docker を使用した起動方法（推奨）

環境を汚さずに簡単に起動できます：

```bash
# リポジトリをクローン
git clone <repository-url>
cd suspect-finder-app

# Docker Compose で起動
docker-compose up --build

# ブラウザで http://localhost:5000 にアクセス
```

### Web UI の使用方法

1. ブラウザで `http://localhost:5000` にアクセス
2. 動画ファイル（MP4, AVI, MOV, MKV）をドラッグ&ドロップまたは選択
3. 「解析を開始」ボタンをクリック
4. 解析結果ページでリアルタイムで進行状況を確認
5. 完了後、結果動画やログファイルをダウンロード

## 💻 ローカル環境での使用方法

```bash
# 依存関係をインストール
pip install -r requirements.txt

# コマンドライン版（基本的な使用方法）
python main.py input_video.mp4

# Web UI版
python web_app.py
# ブラウザで http://localhost:5000 にアクセス
```

## 出力ファイル

- `output.mp4` (または指定した名前): 検出結果付きの動画
- `dump_log.json`: 検知イベントの詳細ログ
- `evidence_*.jpg`: 不法投棄確定時の証拠画像

## 検知ロジック

不法投棄は以下の5段階で判定されます:

1. **侵入**: 人物や車両が監視エリアに進入
2. **設置**: 人物/車両の近くで新しい物体が出現
3. **離脱**: 人物/車両が監視エリアから立ち去る
4. **残留**: 物体がその場に残り続ける
5. **確定**: 物体が30秒以上残留した場合に不法投棄として確定

## 設定パラメータ

`dump_watcher.py`内で以下のパラメータを調整可能:

- `dumping_distance_threshold`: 不法投棄判定の距離閾値 (デフォルト: 150px)
- `confirmation_frames`: 確定までの待機フレーム数 (デフォルト: 900フレーム = 30秒@30fps)
- 検出対象クラス: 人物、車両、物体の種類を設定可能

## 🔧 技術仕様

### バックエンド
- **Python 3.10**
- **YOLOv8** (Ultralytics)
- **OpenCV** - 動画処理
- **Flask** - ウェブAPI

### フロントエンド  
- **HTML/CSS/JavaScript**
- **レスポンシブデザイン**

### 検知アルゴリズム
- 人物・物体の追跡
- 距離変化の分析
- 落下動作の検知
- 時系列データによる投棄判定

## ⚖️ ライセンス

本プロジェクトはAGPL-3.0ライセンスの制約を受けます（Ultralytics YOLO使用のため）

- **個人利用・研究目的**: ✅ 自由に使用可能
- **商用利用**: ⚠️ 要検討（商用ライセンス購入が必要な場合があります）

## 🤝 貢献

プルリクエストやイシューの報告を歓迎します！

## 📝 注意事項

- 初回実行時にYOLOv8モデル（約6MB）の自動ダウンロードが発生します
- 動画解析には時間がかかる場合があります（動画の長さに依存）
- 検知精度は動画の品質や撮影条件に依存します